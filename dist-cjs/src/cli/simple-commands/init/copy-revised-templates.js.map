{"version":3,"sources":["../../../../../src/cli/simple-commands/init/copy-revised-templates.js"],"sourcesContent":["// copy-revised-templates.js - Copy the revised template files from repository\n\nimport fs from 'fs';\nimport path from 'path';\nimport { fileURLToPath } from 'url';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\n// Source directory for revised templates (repository root .claude/commands)\nconst REPO_TEMPLATES_DIR = path.join(__dirname, '../../../../.claude/commands');\n\n/**\n * Copy revised template files from repository to target project\n */\nexport async function copyRevisedTemplates(targetDir, options = {}) {\n  const results = {\n    success: true,\n    copiedFiles: [],\n    skippedFiles: [],\n    errors: []\n  };\n\n  const targetCommandsDir = path.join(targetDir, '.claude/commands');\n\n  try {\n    // Ensure target directory exists\n    await fs.promises.mkdir(targetCommandsDir, { recursive: true });\n\n    // Copy all template files recursively\n    await copyDirectoryRecursive(REPO_TEMPLATES_DIR, targetCommandsDir, options, results);\n\n    // Copy additional .claude files if they exist\n    const additionalFiles = [\n      { source: '../config.json', target: '.claude/config.json' },\n      { source: '../settings.json', target: '.claude/settings.json' }\n    ];\n\n    for (const file of additionalFiles) {\n      const sourcePath = path.join(REPO_TEMPLATES_DIR, file.source);\n      const targetPath = path.join(targetDir, file.target);\n\n      if (fs.existsSync(sourcePath)) {\n        try {\n          const targetDirPath = path.dirname(targetPath);\n          await fs.promises.mkdir(targetDirPath, { recursive: true });\n          \n          if (!fs.existsSync(targetPath) || options.force) {\n            await fs.promises.copyFile(sourcePath, targetPath);\n            results.copiedFiles.push(file.target);\n            if (!options.dryRun) {\n              console.log(`  ✓ Copied ${file.target}`);\n            }\n          } else {\n            results.skippedFiles.push(file.target);\n            if (!options.dryRun) {\n              console.log(`  ⏭️  Skipped ${file.target} (already exists)`);\n            }\n          }\n        } catch (err) {\n          results.errors.push(`Failed to copy ${file.target}: ${err.message}`);\n        }\n      }\n    }\n\n    results.success = results.errors.length === 0;\n  } catch (err) {\n    results.success = false;\n    results.errors.push(`Failed to copy revised templates: ${err.message}`);\n  }\n\n  return results;\n}\n\n/**\n * Recursively copy directory contents\n */\nasync function copyDirectoryRecursive(sourceDir, targetDir, options, results) {\n  try {\n    const entries = await fs.promises.readdir(sourceDir, { withFileTypes: true });\n\n    for (const entry of entries) {\n      const sourcePath = path.join(sourceDir, entry.name);\n      const targetPath = path.join(targetDir, entry.name);\n\n      if (entry.isDirectory()) {\n        // Create directory and recurse\n        await fs.promises.mkdir(targetPath, { recursive: true });\n        await copyDirectoryRecursive(sourcePath, targetPath, options, results);\n      } else if (entry.isFile() && entry.name.endsWith('.md')) {\n        // Copy markdown files\n        try {\n          if (!fs.existsSync(targetPath) || options.force) {\n            if (!options.dryRun) {\n              await fs.promises.copyFile(sourcePath, targetPath);\n            }\n            const relativePath = path.relative(targetDir, targetPath);\n            results.copiedFiles.push(relativePath);\n            if (!options.dryRun && options.verbose) {\n              console.log(`  ✓ Copied ${relativePath}`);\n            }\n          } else {\n            const relativePath = path.relative(targetDir, targetPath);\n            results.skippedFiles.push(relativePath);\n            if (!options.dryRun && options.verbose) {\n              console.log(`  ⏭️  Skipped ${relativePath} (already exists)`);\n            }\n          }\n        } catch (err) {\n          results.errors.push(`Failed to copy ${entry.name}: ${err.message}`);\n        }\n      }\n    }\n  } catch (err) {\n    results.errors.push(`Failed to read directory ${sourceDir}: ${err.message}`);\n  }\n}\n\n/**\n * Copy only specific categories\n */\nexport async function copyRevisedTemplatesByCategory(targetDir, categories, options = {}) {\n  const results = {\n    success: true,\n    copiedFiles: [],\n    skippedFiles: [],\n    errors: []\n  };\n\n  for (const category of categories) {\n    const sourceCategoryDir = path.join(REPO_TEMPLATES_DIR, category);\n    const targetCategoryDir = path.join(targetDir, '.claude/commands', category);\n\n    if (fs.existsSync(sourceCategoryDir)) {\n      await fs.promises.mkdir(targetCategoryDir, { recursive: true });\n      await copyDirectoryRecursive(sourceCategoryDir, targetCategoryDir, options, results);\n    } else {\n      results.errors.push(`Category '${category}' not found in templates`);\n    }\n  }\n\n  results.success = results.errors.length === 0;\n  return results;\n}\n\n/**\n * Validate that source templates exist\n */\nexport function validateTemplatesExist() {\n  if (!fs.existsSync(REPO_TEMPLATES_DIR)) {\n    return {\n      valid: false,\n      error: `Template directory not found: ${REPO_TEMPLATES_DIR}`\n    };\n  }\n\n  const requiredCategories = ['analysis', 'github', 'sparc', 'coordination'];\n  const missingCategories = [];\n\n  for (const category of requiredCategories) {\n    const categoryPath = path.join(REPO_TEMPLATES_DIR, category);\n    if (!fs.existsSync(categoryPath)) {\n      missingCategories.push(category);\n    }\n  }\n\n  if (missingCategories.length > 0) {\n    return {\n      valid: false,\n      error: `Missing required template categories: ${missingCategories.join(', ')}`\n    };\n  }\n\n  return { valid: true };\n}"],"names":["fs","path","fileURLToPath","__filename","url","__dirname","dirname","REPO_TEMPLATES_DIR","join","copyRevisedTemplates","targetDir","options","results","success","copiedFiles","skippedFiles","errors","targetCommandsDir","promises","mkdir","recursive","copyDirectoryRecursive","additionalFiles","source","target","file","sourcePath","targetPath","existsSync","targetDirPath","force","copyFile","push","dryRun","console","log","err","message","length","sourceDir","entries","readdir","withFileTypes","entry","name","isDirectory","isFile","endsWith","relativePath","relative","verbose","copyRevisedTemplatesByCategory","categories","category","sourceCategoryDir","targetCategoryDir","validateTemplatesExist","valid","error","requiredCategories","missingCategories","categoryPath"],"mappings":"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"}